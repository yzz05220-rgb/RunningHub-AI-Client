# RunningHub-AI-Client 开发路线图

## 📊 项目对比总览

### 原版 vs 当前版本功能对比

| 功能模块 | 原版 | 当前版本 | 状态 |
|---------|------|---------|------|
| 基础任务执行 | ✅ | ✅ | 保留 |
| 单任务运行 | ✅ | ✅ | 增强 |
| 结果预览 | ✅ 九宫格 | ✅ 详细卡片 | **重构** |
| 应用管理 | ❌ | ✅ 应用库 | **新增** |
| 后台任务系统 | ❌ | ✅ 完整系统 | **新增** |
| 任务并发 | ❌ | ✅ 最多3个 | **新增** |
| 任务队列 | ❌ | ✅ 自动排队 | **新增** |
| 任务取消 | ❌ | ✅ 支持 | **新增** |
| 历史持久化 | ❌ | ✅ LocalStorage | **新增** |
| 任务管理器 | ❌ | ✅ 可拖拽浮窗 | **新增** |
| 进度追踪 | ❌ | ✅ 实时显示 | **新增** |
| 错误处理 | ⚠️ 基础 | ✅ 完善 | **增强** |
| 全局设置 | ❌ | ✅ API配置 | **新增** |
| 应用导入 | ❌ | ✅ 向导式 | **新增** |
| Toast通知 | ❌ | ✅ 成功/失败 | **新增** |

---

## ✨ 已完成功能详解

### 🎯 核心功能

#### 1. 应用库管理系统
**文件**: `components/AppLibrarySidebar.tsx`, `services/appService.ts`

- ✅ 应用导入向导（两步流程：输入 WebApp ID → 自定义名称/颜色）
- ✅ 应用列表展示（网格布局，带图标和颜色）
- ✅ 应用收藏功能
- ✅ 应用删除功能
- ✅ LocalStorage 持久化
- ✅ WebApp ID 验证

**新增代码量**: ~500 行

---

#### 2. 后台任务管理系统
**文件**: `stores/taskStore.ts`, `components/TaskFloater.tsx`

##### 任务生命周期管理
- ✅ 任务创建与参数配置
- ✅ 自动队列管理（超过并发限制自动排队）
- ✅ 并发控制（最多同时运行 3 个任务）
- ✅ 任务状态流转：`QUEUED → PENDING → RUNNING → SUCCESS/FAILED`
- ✅ 实时进度更新（轮询 API 获取进度）
- ✅ 超时处理（60分钟自动标记失败）

##### 任务操作
- ✅ 取消运行中的任务（调用 Cancel API）
- ✅ 删除单个结果图片
- ✅ 清空历史记录
- ✅ 删除失败/完成的任务

##### 数据持久化
- ✅ 使用 Zustand + persist 中间件
- ✅ LocalStorage 存储已完成/失败任务
- ✅ 页面刷新后恢复历史记录

**新增代码量**: ~800 行

---

#### 3. 可拖拽任务管理器浮窗
**文件**: `components/TaskFloater.tsx`

- ✅ 拖拽移动（鼠标按住标题栏拖动）
- ✅ 位置持久化（LocalStorage 保存位置）
- ✅ 边界限制（防止拖出屏幕）
- ✅ 展开/收起（查看详细任务列表）
- ✅ 实时统计（运行中/排队/完成/失败任务数）
- ✅ Toast 通知（任务完成/失败弹窗提示）

**样式特性**:
- 图标动画（运行中图标旋转 + 渐变背景）
- 智能配色（运行中=品牌色，失败=红色，完成=绿色）
- 光标提示（`cursor-grab` / `cursor-grabbing`）

**新增代码量**: ~290 行

---

#### 4. 历史记录界面重构
**文件**: `components/StepResult.tsx`, `types.ts`, `App.tsx`

##### 数据结构升级
```typescript
interface HistoryItem {
  id: string;              // 本地任务 ID
  remoteTaskId?: string;   // RunningHub 远程任务 ID
  timestamp: number;       // 完成时间戳
  startTime: number;       // 开始时间
  endTime?: number;        // 结束时间
  appName?: string;        // 应用名称
  appId?: string;          // 应用 ID
  error?: string;          // 错误信息
  outputs: TaskOutput[];   // 结果列表
  status: 'SUCCESS' | 'FAILED';
}
```

##### UI/UX 重构
- ✅ 圆角卡片设计（`rounded-2xl` 外框 + `rounded-lg` 图片）
- ✅ 展开/收起模式
  - 收起：应用名 + 状态点 + 结果图片
  - 展开：完整元数据（Task ID、时长、时间、错误信息）
- ✅ 垂直图片堆叠（单列布局，完整显示图片比例）
- ✅ 图片分隔线（`border-t border-white/10`）
- ✅ 自适应文本（收起截断，展开换行）
- ✅ 悬浮操作（放大预览、下载按钮）

**新增/重写代码量**: ~350 行

---

#### 5. 全局设置系统
**文件**: `App.tsx`

- ✅ 设置模态框
- ✅ RunningHub API Key 配置
- ✅ Access Token 配置
- ✅ LocalStorage 持久化

**新增代码量**: ~150 行

---

### 📈 数据统计

#### 代码规模对比
| 指标 | 原版 | 当前版本 | 增长 |
|------|------|---------|------|
| 总行数 | ~2,500 | ~5,678 | +127% |
| 组件数 | 5 | 8 | +3 |
| 服务层 | 1 | 2 | +1 |
| 状态管理 | 0 | 1 | +1 |
| 类型定义 | ~50行 | ~150行 | +200% |

#### 功能模块占比
```
应用库系统:        15%
任务管理系统:      35%
历史记录UI:        12%
任务浮窗:          10%
原有功能增强:      18%
其他(设置/工具):   10%
```

---

## 🚀 已实现的技术增强

### 架构改进
1. ✅ **状态管理**: Zustand + persist 中间件
2. ✅ **数据持久化**: LocalStorage 全局应用
3. ✅ **类型安全**: 完整 TypeScript 类型定义
4. ✅ **错误处理**: 统一错误提示 + Toast 通知
5. ✅ **API 封装**: 服务层抽象 (appService, taskStore)

### UI/UX 提升
1. ✅ **设计系统统一**: 圆角、配色、间距一致
2. ✅ **交互反馈**: 悬浮效果、光标提示、加载状态
3. ✅ **响应式布局**: 自适应宽度、文本换行
4. ✅ **动画效果**: 图标旋转、淡入淡出、滑动
5. ✅ **可访问性**: 清晰的按钮标签、hover 提示

### 性能优化
1. ✅ **事件监听器管理**: useEffect 自动清理
2. ✅ **条件渲染**: 减少不必要的 DOM 更新
3. ✅ **防抖节流**: 拖拽事件优化
4. ✅ **懒加载**: 图片按需加载

---

## 📋 待开发功能规划

### 高优先级 (P0)

#### 1. 客户端功能增强 (Electron)
**目标**: 提供原生应用体验和高级管理功能

- [ ] **检测更新 (Auto-Update)**: 支持应用内自动检测新版本并热更新
- [ ] **安装包分发 (NSIS)**: 制作标准的 Windows 安装程序 (.exe)
- [ ] **后台管理系统**: 集成更高级的任务监控和用户管理面板
- [ ] **托盘图标**: 系统托盘常驻，支持最小化到托盘

**预计工作量**: 5-7天

#### 2. 批量任务增强
**目标**: 支持一次性导入多个图片/参数，批量生成

- [ ] 批量文件选择器
- [ ] 批量任务队列预览
- [ ] 批量进度显示
- [ ] 批量结果下载

**预计工作量**: 3-5天

---

#### 3. 历史记录高级功能
**目标**: 让用户能快速找到和管理历史任务

- [ ] 搜索功能（按应用名、Task ID、日期）
- [ ] 筛选功能（按状态、应用、日期范围）
- [ ] 按应用分组视图
- [ ] 批量导出（ZIP 打包下载）
- [ ] 历史统计（成功率、使用频率）

**预计工作量**: 5-7天

---

### 中优先级 (P1)

#### 4. 任务重试与复用
**目标**: 快速重新运行历史任务

- [ ] "重新运行"按钮（使用相同参数）
- [ ] "编辑后重试"（修改参数后运行）
- [ ] 失败任务一键重试
- [ ] 参数模板保存

**预计工作量**: 2-3天

---

#### 5. 任务管理器增强
**目标**: 提升任务管理体验

- [ ] 双击标题栏复位到默认位置
- [ ] 最小化/隐藏功能
- [ ] 快捷键支持（Ctrl+T 显示/隐藏）
- [ ] 任务详情悬浮提示
- [ ] 自定义并发数量

**预计工作量**: 2-3天

### 低优先级 (P2)

#### 6. 应用库高级功能
- [ ] 应用分类/标签系统
- [ ] 应用使用频率排序
- [ ] 批量导入应用

#### 7. 结果图片管理
- [ ] 图片对比视图
- [ ] 图片编辑器集成
- [ ] 复制到剪贴板

#### 8. 主题与个性化
- [ ] 深色/浅色主题切换
- [ ] 自定义品牌色

---

## 🎯 近期开发计划 (接下来2周)

### Week 1: 客户端分发与更新
1. **Day 1-2**: NSIS 安装包制作 (Electron Builder)
2. **Day 3-4**: 自动更新模块集成 (electron-updater)
3. **Day 5**: 发布第一个正式版本 v1.1.0

### Week 2: 批量任务与历史记录
1. **Day 1-2**: 批量文件上传与队列预览
2. **Day 3-4**: 历史记录搜索和筛选
3. **Day 5**: 稳定性测试与 Bug 修复

---

## 🐛 已知问题 (Backlog)

### 技术债务
- [ ] 部分组件过大，需要拆分（TaskFloater.tsx > 290行）
- [ ] API 错误处理需要更细粒度
- [ ] 缺少单元测试

### Bug修复
- [ ] 拖拽在多显示器环境下的边界计算
- [ ] 长任务名称在窄屏下的截断优化

### 性能优化
- [ ] 历史记录过多时的虚拟滚动
- [ ] 图片懒加载策略优化
- [ ] LocalStorage 数据量过大时的处理

---

## 📊 开发进度追踪

### 已完成 (v1.1.0)
- ✅ 应用库管理系统
- ✅ 后台任务系统
- ✅ 任务管理器拖拽
- ✅ 历史记录重构
- ✅ 全局设置
- ✅ 客户端初步打包 (Electron Portable)

### 正在开发 (v1.2.0 计划)
- 🚧 客户端安装包 (EXE)
- 🚧 自动更新功能

### 计划中 (v1.3.0+)
- 📅 批量任务支持
- 📅 历史记录搜索/筛选
- 📅 任务重试与复用

---

## 🎉 总结

由原版的基础任务执行工具升级为功能完善的 AI 客户端，v1.1.0 已具备完整的使用价值。接下来的重点转向 **客户端分发** (安装包/更新) 和 **批量生产力** 工具的开发。

---

*最后更新: 2026-01-16*  
*版本: v1.1.0*
