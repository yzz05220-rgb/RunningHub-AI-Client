# 更新日志 / Changelog

## v1.1.0 - 2026-01-16

### ✨ 新功能

#### 历史记录界面重构
- **详细任务卡片视图**：历史记录从简单的九宫格图片升级为详细的任务卡片展示
- **展开/收起模式**：
  - 收起状态：仅显示应用名称和结果图片，界面简洁
  - 展开状态：显示完整的任务详情（Task ID、运行时长、完成时间等）
- **圆角卡片设计**：采用 `rounded-2xl` 圆角卡片，与整体 UI 风格一致
- **图片分隔线**：多张结果图片之间使用清晰的分隔线，提升可读性
- **垂直图片堆叠**：所有结果图片采用垂直单列布局，完整显示图片比例
- **自适应文本**：应用名称在展开时支持换行完整显示，收起时自动截断

#### 任务管理器拖拽功能
- **自由拖动**：按住任务管理器标题栏可拖动到屏幕任意位置
- **位置记忆**：使用 LocalStorage 保存位置，刷新页面后位置保持不变
- **边界保护**：防止组件被拖拽到屏幕外
- **视觉反馈**：拖动时光标变为 `grabbing` 手型，提供清晰的操作提示
- **智能交互**：点击按钮不会触发拖拽，确保操作流畅

### 🎨 UI/UX 改进

#### 历史记录侧边栏
- 优化了卡片间距和内边距，视觉更加舒适
- 统一了圆角设计语言（外框 `rounded-2xl`，图片 `rounded-lg`）
- 改进了失败状态的错误信息显示
- 增强了悬浮交互效果（放大预览、下载按钮）

#### 任务管理器
- 添加了 `cursor-grab` 光标样式提示
- 保持了展开/收起功能的正常工作
- 优化了拖拽体验，流畅无卡顿

### 🔧 技术优化

#### 数据结构增强
- `HistoryItem` 接口新增字段：
  - `remoteTaskId`: RunningHub 远程任务 ID
  - `startTime`: 任务开始时间
  - `endTime`: 任务结束时间
  - `appName`: 所属应用名称
  - `appId`: 应用 ID
  - `error`: 错误信息（失败时）

#### 组件重构
- **StepResult.tsx**：完全重写历史记录渲染逻辑
  - 实现了条件渲染（基于 `isExpanded` prop）
  - 优化了图片布局算法
  - 添加了时间格式化工具函数
- **TaskFloater.tsx**：添加拖拽状态管理
  - 使用 React Hooks 管理拖拽状态
  - 实现了防抖和边界检测
  - 集成 localStorage 持久化

#### 性能优化
- 使用 `useEffect` 优化拖拽事件监听器的注册和清理
- 图片懒加载和条件渲染减少不必要的 DOM 操作

### 📝 文件变更

**新增文件**：
- `components/AppLibrarySidebar.tsx`
- `components/TaskFloater.tsx`
- `services/appService.ts`
- `stores/taskStore.ts`

**修改文件**：
- `App.tsx` - 集成新组件和状态管理
- `types.ts` - 扩展类型定义
- `components/StepResult.tsx` - 历史记录界面重构
- `components/StepConfig.tsx` - 细节优化
- `components/StepEditor.tsx` - 微调
- `services/api.ts` - API 集成
- `package.json` / `package-lock.json` - 依赖更新

---

## 使用说明

### 历史记录查看
1. 在右侧边栏点击"展开"图标可查看任务详情
2. 点击任意图片可全屏预览
3. 悬浮在图片上显示操作按钮（放大、下载）

### 任务管理器移动
1. 按住任务管理器顶部区域即可拖动
2. 拖动到合适位置后释放鼠标
3. 位置会自动保存，下次打开时保持不变

---

## 已知问题
- 无

## 下一步计划
- [ ] 添加历史记录搜索和筛选功能
- [ ] 支持任务重新运行
- [ ] 添加批量导出功能
- [ ] 优化移动端适配
